<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Depo Otomasyonu</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    body { background: #0f172a; color: #e2e8f0; font-family: system-ui, Arial; margin:0; }
    .hidden { display: none !important; }
    header {
      background:#111827; padding:10px 20px; display:flex;
      align-items:center; justify-content:space-between;
      border-bottom:1px solid #1e293b;
    }
    h1 { font-size:20px; margin:0; color:#93c5fd; }
    nav button { margin-right:5px; }
    .logout-btn {
      background:#ef4444; border:none; color:white; padding:6px 10px;
      border-radius:6px; cursor:pointer; font-weight:600;
    }
  </style>
</head>
<body>
  <header>
    <h1>📦 Depo Otomasyonu</h1>
    <div>
      <button id="logoutBtn" class="logout-btn hidden">Çıkış Yap</button>
    </div>
  </header>

  <main>
    <!-- GİRİŞ EKRANI -->
    <section id="view-login" class="view">
      <h2>🔑 Giriş</h2>
      <input type="email" id="login-email" placeholder="Email"/><br/>
      <input type="password" id="login-pass" placeholder="Şifre"/><br/>
      <button id="loginBtn">Giriş</button>
      <hr/>
      <h3>Yeni Kayıt</h3>
      <input type="email" id="reg-email" placeholder="Email"/><br/>
      <input type="password" id="reg-pass" placeholder="Şifre"/><br/>
      <select id="reg-role">
        <option value="sube">Şube</option>
        <option value="yonetici">Yönetici</option>
        <option value="admin">Admin</option>
      </select><br/>
      <button id="registerBtn">Kayıt Ol</button>
      <p id="loginStatus" style="color:#38bdf8;"></p>
    </section>

    <!-- ŞUBE EKRANI -->
    <section id="view-branch" class="view hidden">
      <h2>🏪 Şube Ekranı</h2>
      <p>Şubeler sipariş oluşturabilir.</p>
    </section>

    <!-- YÖNETİCİ EKRANI -->
    <section id="view-manager" class="view hidden">
      <h2>👨‍💼 Yönetici Paneli</h2>
      <p>Burada tüm siparişler görünür.</p>
    </section>

    <!-- ADMIN EKRANI -->
    <section id="view-admin" class="view hidden">
      <h2>🛠️ Admin Kontrol Paneli</h2>
      <p>Admin her ekrana erişebilir.</p>
    </section>
  </main>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDcLQB4UggXlYA9x8AKw-XybJjcF6U_KA4",
      authDomain: "depo1-4668f.firebaseapp.com",
      projectId: "depo1-4668f",
      storageBucket: "depo1-4668f.appspot.com",
      messagingSenderId: "1044254626353",
      appId: "1:1044254626353:web:148c57df2456cc3d9e3b10"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const $ = id => document.getElementById(id);

    // 🔹 Oturum kontrolü
    onAuthStateChanged(auth, async user => {
      if (user) {
        const roleDoc = await getDoc(doc(db, "users", user.uid));
        const role = roleDoc.exists() ? roleDoc.data().role : "sube";
        $("view-login").classList.add("hidden");
        $("logoutBtn").classList.remove("hidden");

        // Tüm view'leri gizle
        document.querySelectorAll(".view").forEach(v=>v.classList.add("hidden"));

        if(role === "sube") $("view-branch").classList.remove("hidden");
        else if(role === "yonetici") $("view-manager").classList.remove("hidden");
        else if(role === "admin"){
          $("view-branch").classList.remove("hidden");
          $("view-manager").classList.remove("hidden");
          $("view-admin").classList.remove("hidden");
        }
      } else {
        // çıkış veya login yoksa
        $("view-login").classList.remove("hidden");
        $("logoutBtn").classList.add("hidden");
        document.querySelectorAll(".view").forEach(v=>{
          if(v.id!=="view-login") v.classList.add("hidden");
        });
      }
    });

    // 🔹 Giriş
    $("loginBtn").addEventListener("click", async ()=>{
      try {
        await signInWithEmailAndPassword(auth, $("login-email").value, $("login-pass").value);
        $("loginStatus").textContent = "Giriş başarılı!";
      } catch(e){
        $("loginStatus").textContent = "Hata: "+e.message;
      }
    });

    // 🔹 Kayıt
    $("registerBtn").addEventListener("click", async ()=>{
      try {
        const cred = await createUserWithEmailAndPassword(auth, $("reg-email").value, $("reg-pass").value);
        await setDoc(doc(db,"users",cred.user.uid), {email:$("reg-email").value, role:$("reg-role").value});
        $("loginStatus").textContent = "Kayıt tamamlandı.";
      } catch(e){
        $("loginStatus").textContent = "Hata: "+e.message;
      }
    });

    // 🔹 Çıkış
    $("logoutBtn").addEventListener("click", async ()=>{
      await signOut(auth);
      $("loginStatus").textContent = "Çıkış yapıldı.";
    });
  </script>
</body>
</html>
