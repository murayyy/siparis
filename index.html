<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Depo Otomasyonu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-left">
      <span class="logo">ğŸ“¦ Depo Otomasyonu</span>
    </div>
    <div class="topbar-right">
      <button id="btnLogin" class="btn btn-light">GiriÅŸ</button>
      <button id="btnLogout" class="btn btn-danger hidden">Ã‡Ä±kÄ±ÅŸ</button>
    </div>
  </header>

  <!-- LOGIN -->
  <main id="loginSection" class="view">
    <div class="card auth-card">
      <h2>Depo GiriÅŸ</h2>
      <label>E-posta</label>
      <input id="email" type="email" placeholder="kullanici@firma.com" />
      <label>Åifre</label>
      <input id="password" type="password" placeholder="Åifre" />
      <button id="signinBtn" class="btn btn-primary">GiriÅŸ Yap</button>
      <p id="loginMsg" class="muted"></p>
      <p class="hint">
        <strong>Not:</strong> KullanÄ±cÄ± rolÃ¼ (manager/picker/qc) Firebase Firestore'da
        <code>users/{uid}.role</code> alanÄ±ndan okunur.
      </p>
    </div>
  </main>

  <!-- MAIN APP -->
  <main id="ordersSection" class="view hidden">
    <div class="layout">
      <aside class="sidebar">
        <h3>MenÃ¼</h3>
        <button id="btnNewOrder" class="btn btn-primary full">â• Yeni SipariÅŸ</button>
        <button id="btnExportCsv" class="btn btn-light full">ğŸ“¤ CSV DÄ±ÅŸa Aktar (F9)</button>
        <hr />
        <div class="info-box">
          <div><strong>KullanÄ±cÄ±:</strong> <span id="userName"></span></div>
          <div><strong>Rol:</strong> <span id="userRole"></span></div>
        </div>
        <p class="muted small">
          KÄ±sayollar: <br />
          â€¢ F9: CSV dÄ±ÅŸa aktar<br />
          â€¢ Barkod: Kamera + BarcodeDetector (varsa)
        </p>
      </aside>

      <section class="main">
        <h2>SipariÅŸler</h2>
        <div class="toolbar">
          <input id="searchInput" class="input" placeholder="Ara: ÅŸube, Ã¼rÃ¼n, kod..." />
          <button id="btnRefresh" class="btn btn-light">Yenile</button>
        </div>
        <div id="orderList" class="order-list">
          <!-- sipariÅŸ kartlarÄ± buraya gelecek -->
        </div>
      </section>
    </div>
  </main>

  <!-- YENÄ° SÄ°PARÄ°Å MODALI -->
  <dialog id="orderModal" class="modal">
    <form method="dialog" class="card modal-card" onsubmit="return false;">
      <h3>Yeni SipariÅŸ</h3>
      <label>Åube</label>
      <input id="branchInput" class="input" placeholder="Ã–r: KonyaaltÄ±" />
      <label>ÃœrÃ¼n AdÄ±</label>
      <input id="productInput" class="input" placeholder="Ã–r: Ay Ã‡ekirdeÄŸi 1kg" />
      <label>Miktar</label>
      <input id="qtyInput" class="input" type="number" min="1" value="1" />
      <div class="modal-actions">
        <button id="saveOrderBtn" class="btn btn-primary">Kaydet</button>
        <button id="cancelOrderBtn" class="btn btn-light" type="button">Ä°ptal</button>
      </div>
    </form>
  </dialog>

  <!-- Firebase SDK (Compat KEEP edilmiÅŸtir â€” AMA modÃ¼l Ã§akÄ±ÅŸmasÄ±n diye ESM modÃ¼llerden ayrÄ± durur) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <!-- Firebase ESM + App (module olarak yÃ¼klenir) -->
  <script type="module" src="firebase.js"></script>
  <script type="module" src="app.js"></script>

  <!-- PWA Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js").catch(() => {});
    }
  </script>
</body>
</html>
